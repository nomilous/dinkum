// Generated by CoffeeScript 1.6.3
var RequestFilter, Requestor, defer, deferred, enclose, testable, _ref;

_ref = require('also'), enclose = _ref.enclose, deferred = _ref.deferred;

RequestFilter = require('../support').RequestFilter;

defer = require('when').defer;

Requestor = require('./requestor').Requestor;

testable = void 0;

exports._client = function() {
  return testable;
};

exports.Client = enclose(Requestor, function(requestor, config) {
  var api, client;
  if (config == null) {
    config = {};
  }
  client = {
    requestor: requestor,
    get: RequestFilter(config, function(opts, result) {
      if (result == null) {
        result = defer();
      }
      opts.method = 'GET';
      requestor.request(opts, result).then(function() {}, result.error, result.notify);
      return result.promise;
    }),
    post: RequestFilter(config, function(opts, result) {
      if (result == null) {
        result = defer();
      }
      opts.method = 'POST';
      requestor.request(opts, result).then(function() {}, result.error, result.notify);
      return result.promise;
    }),
    put: RequestFilter(config, function(opts, result) {
      if (result == null) {
        result = defer();
      }
      opts.method = 'PUT';
      requestor.request(opts, result).then(function() {}, result.error, result.notify);
      return result.promise;
    }),
    "delete": RequestFilter(config, function(opts, result) {
      if (result == null) {
        result = defer();
      }
      opts.method = 'DELETE';
      requestor.request(opts, result).then(function() {}, result.error, result.notify);
      return result.promise;
    }),
    stats: deferred(function(action, opts, callback) {
      var notify, reject, resolve;
      resolve = action.resolve, reject = action.reject, notify = action.notify;
      return requestor.stats().then(function(stats) {
        if (callback != null) {
          callback(null, stats);
        }
        return resolve(stats);
      }, function(error) {
        if (callback != null) {
          callback(error);
        }
        return reject(error);
      }, notify);
    }),
    errors: {
      next: function(opts, callback) {
        return callback(null, {
          just: 'a thought for now'
        });
      },
      prev: function(opts, callback) {
        return callback(null, {
          but: '...'
        });
      },
      flag: function(opts, callback) {
        return callback(null, {
          "this": {
            idea: {
              has: 'juice'
            }
          }
        });
      },
      'imagine': function(_arg, callback) {
        var apiUserEntity, hub, request;
        hub = _arg.hub, apiUserEntity = _arg.apiUserEntity, request = _arg.request;
      }
    }
  };
  client.errors.next.$$notice = {};
  client.errors.prev.$$notice = {};
  client.errors.flag.$$notice = {};
  client.stats.$$notice = {};
  testable = client;
  return api = {
    get: client.get,
    post: client.post,
    put: client.put,
    "delete": client["delete"],
    stats: client.stats,
    errors: client.errors
  };
});
